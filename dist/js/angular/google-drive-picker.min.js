!function(e){"use strict";e.module("risevision.widget.common.google-drive-picker",["risevision.common.i18n"]).directive("googleDrivePicker",["$window","$document","$log","$templateCache","apiAuth","apiGooglePicker",function(e,o,t,i,n,r){return{restrict:"E",scope:{viewId:"@"},template:i.get("google-drive-picker-template.html"),link:function(i,c,a){var u=o[0],l=a.viewId||"docs";function s(e){r.get().then(function(o){e[o.picker.Response.ACTION]===o.picker.Action.PICKED?(t.debug("Files picked",e[o.picker.Response.DOCUMENTS]),i.$emit("picked",e[o.picker.Response.DOCUMENTS])):e[o.picker.Response.ACTION]===o.picker.Action.CANCEL&&(t.debug("File pick cancelled"),i.$emit("cancel"))})}function d(o){var t,i=u.createElement("a");u.referrer?"localhost"===u.location.hostname?t=e.location.protocol+"//"+e.location.host:(i.href=u.referrer,t=i.protocol+"//"+i.hostname):t=e.location.protocol+"//"+e.location.host,(new o.picker.PickerBuilder).setOrigin(t).addView(l).setOAuthToken(n.getAuthToken()).setCallback(s).build().setVisible(!0)}c.on("click",function(){n.getAuthToken()?r.get().then(d):n.getAuthToken()||n.authorize(!1).then(function(e){e&&!e.error&&r.get().then(d)})}),n.authorize(!0).then(null,function(e){t.warn(e)})}}}])}(angular),function(e){try{e=angular.module("risevision.widget.common.google-drive-picker")}catch(o){e=angular.module("risevision.widget.common.google-drive-picker",[])}e.run(["$templateCache",function(e){"use strict";e.put("google-drive-picker-template.html",'<div class="google-drive-picker">\n  <button type="button" class="btn btn-default">\n    {{"google-drive-picker.select" | translate }}\n    <img class="icon-right" src="//s3.amazonaws.com/Rise-Images/Icons/drive.svg">\n  </button>\n</div>\n')}])}();var isClientJS=!1;function handleClientJSLoad(){isClientJS=!0;var e=document.createEvent("Events");e.initEvent("gapi.loaded",!0,!0),window.dispatchEvent(e)}!function(e){"use strict";e.module("risevision.widget.common.google-drive-picker").factory("oauthAPILoader",["$q","$log","gapiLoader",function(e,o,t){var i,n=e.defer();return{get:function(){return i||(i=n.promise,t.get().then(function(e){e.load("auth",function(){o.info("auth API is loaded"),n.resolve(e)})})),i}}}]).factory("gapiLoader",["$q","$window",function(e,o){return{get:function(){var t,i=e.defer();return o.isClientJS?i.resolve(o.gapi):(t=function(){i.resolve(o.gapi),o.removeEventListener("gapi.loaded",t,!1)},o.addEventListener("gapi.loaded",t,!1)),i.promise}}}]).factory("pickerLoader",["$q","$window","$log","gapiLoader",function(e,o,t,i){return{get:function(){var o,n=e.defer();return o||(o=n.promise,i.get().then(function(e){e.load("picker",function(){t.info("picker API is loaded"),n.resolve(e)})})),o}}}])}(angular),function(e){"use strict";e.module("risevision.widget.common.google-drive-picker").value("CLIENT_ID","343504042718-oi19fakuj8fdfa015p7k2gkn2vkshdfh.apps.googleusercontent.com").value("SCOPE",["https://www.googleapis.com/auth/drive.readonly"]).factory("apiAuth",["$q","$http","$log","gapiLoader","oauthAPILoader","CLIENT_ID","SCOPE",function(e,o,t,i,n,r,c){var a=null,u={authorize:function(o){var i=e.defer(),u={client_id:r,scope:c,immediate:o};return n.get().then(function(e){e.auth.authorize(u,function(e){e&&!e.error?(a=e.access_token,i.resolve(e)):(i.reject("Authentication Error: "+e.error),t.debug("authorize result",e))})}),i.promise},getAuthToken:function(){return a}};return u}])}(angular),function(e){"use strict";e.module("risevision.widget.common.google-drive-picker").factory("apiGooglePicker",["$q","$window","$log","pickerLoader",function(e,o,t,i){var n,r=e.defer();return{get:function(){return n||(n=r.promise,i.get().then(function(){r.resolve(o.google)})),n}}}])}(angular);