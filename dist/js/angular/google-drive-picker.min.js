!function(){"use strict";angular.module("risevision.widget.common.google-drive-picker",["risevision.common.i18n"]).directive("googleDrivePicker",["$window","$document","$log","$templateCache","apiAuth","apiGooglePicker",function(a,u,l,e,s,d){return{restrict:"E",scope:{viewId:"@"},template:e.get("google-drive-picker-template.html"),link:function(o,e,i){var t=u[0],n=i.viewId||"docs";function r(i){d.get().then(function(e){i[e.picker.Response.ACTION]===e.picker.Action.PICKED?(l.debug("Files picked",i[e.picker.Response.DOCUMENTS]),o.$emit("picked",i[e.picker.Response.DOCUMENTS])):i[e.picker.Response.ACTION]===e.picker.Action.CANCEL&&(l.debug("File pick cancelled"),o.$emit("cancel"))})}function c(e){var i=(t.referrer,a.location.protocol+"//"+a.location.host);(new e.picker.PickerBuilder).setOrigin(i).addView(n).setOAuthToken(s.getAuthToken()).setCallback(r).build().setVisible(!0)}e.on("click",function(){s.getAuthToken()?d.get().then(c):s.getAuthToken()||s.authorize(!1).then(function(e){e&&!e.error&&d.get().then(c)})}),s.authorize(!0).then(null,function(e){l.warn(e)})}}}])}(),function(i){try{i=angular.module("risevision.widget.common.google-drive-picker")}catch(e){i=angular.module("risevision.widget.common.google-drive-picker",[])}i.run(["$templateCache",function(e){"use strict";e.put("google-drive-picker-template.html",'<div class="google-drive-picker">\n  <button type="button" class="btn btn-default">\n    {{"google-drive-picker.select" | translate }}\n    <img class="icon-right" src="//s3.amazonaws.com/Rise-Images/Icons/drive.svg">\n  </button>\n</div>\n')}])}();var isClientJS=!1;function handleClientJSLoad(){isClientJS=!0;var e=document.createEvent("Events");e.initEvent("gapi.loaded",!0,!0),window.dispatchEvent(e)}!function(){"use strict";angular.module("risevision.widget.common.google-drive-picker").factory("oauthAPILoader",["$q","$log","gapiLoader",function(e,i,o){var t,n=e.defer();return{get:function(){return t||(t=n.promise,o.get().then(function(e){e.load("auth",function(){i.info("auth API is loaded"),n.resolve(e)})})),t}}}]).factory("gapiLoader",["$q","$window",function(o,t){return{get:function(){var e,i=o.defer();return t.isClientJS?i.resolve(t.gapi):(e=function(){i.resolve(t.gapi),t.removeEventListener("gapi.loaded",e,!1)},t.addEventListener("gapi.loaded",e,!1)),i.promise}}}]).factory("pickerLoader",["$q","$window","$log","gapiLoader",function(o,e,t,n){return{get:function(){var e,i=o.defer();return e||(e=i.promise,n.get().then(function(e){e.load("picker",function(){t.info("picker API is loaded"),i.resolve(e)})})),e}}}])}(),function(){"use strict";angular.module("risevision.widget.common.google-drive-picker").value("CLIENT_ID","343504042718-oi19fakuj8fdfa015p7k2gkn2vkshdfh.apps.googleusercontent.com").value("SCOPE",["https://www.googleapis.com/auth/drive.readonly"]).factory("apiAuth",["$q","$http","$log","gapiLoader","oauthAPILoader","CLIENT_ID","SCOPE",function(t,e,n,i,r,c,a){var u=null,o={authorize:function(e){var i=t.defer(),o={client_id:c,scope:a,immediate:e};return r.get().then(function(e){e.auth.authorize(o,function(e){e&&!e.error?(u=e.access_token,i.resolve(e)):(i.reject("Authentication Error: "+e.error),n.debug("authorize result",e))})}),i.promise},getAuthToken:function(){return u}};return o}])}(),function(){"use strict";angular.module("risevision.widget.common.google-drive-picker").factory("apiGooglePicker",["$q","$window","$log","pickerLoader",function(e,i,o,t){var n,r=e.defer();return{get:function(){return n||(n=r.promise,t.get().then(function(){r.resolve(i.google)})),n}}}])}();