!function(){"use strict";angular.module("risevision.widget.common.google-drive-picker",["risevision.common.i18n"]).directive("googleDrivePicker",["$window","$document","$log","$templateCache","apiAuth","apiGooglePicker",function(a,u,l,e,g,s){return{restrict:"E",scope:{viewId:"@",topConfig:"="},template:e.get("google-drive-picker-template.html"),link:function(i,e,o){var t=u[0],n=o.viewId||"docs";function r(o){s.get().then(function(e){o[e.picker.Response.ACTION]===e.picker.Action.PICKED?(l.debug("Files picked",o[e.picker.Response.DOCUMENTS]),i.$emit("picked",o[e.picker.Response.DOCUMENTS])):o[e.picker.Response.ACTION]===e.picker.Action.CANCEL&&(l.debug("File pick cancelled"),i.$emit("cancel"))})}function c(e){var o=i.topConfig&&i.topConfig.origin?i.topConfig.origin:(t.referrer,a.location.protocol+"//"+a.location.host);(new e.picker.PickerBuilder).setOrigin(o).addView(n).setOAuthToken(g.getAuthToken()).setCallback(r).build().setVisible(!0)}e.on("click",function(){g.getAuthToken()?s.get().then(c):g.getAuthToken()||g.authorize(!1).then(function(e){e&&!e.error&&s.get().then(c)})}),g.authorize(!0).then(null,function(e){l.warn(e)})}}}])}(),function(o){try{o=angular.module("risevision.widget.common.google-drive-picker")}catch(e){o=angular.module("risevision.widget.common.google-drive-picker",[])}o.run(["$templateCache",function(e){"use strict";e.put("google-drive-picker-template.html",'<div class="google-drive-picker">\n  <button type="button" class="btn btn-default">\n    {{"google-drive-picker.select" | translate }}\n    <img class="icon-right" src="//s3.amazonaws.com/Rise-Images/Icons/drive.svg">\n  </button>\n</div>\n')}])}();var isClientJS=!1;function handleClientJSLoad(){isClientJS=!0;var e=document.createEvent("Events");e.initEvent("gapi.loaded",!0,!0),window.dispatchEvent(e)}!function(){"use strict";angular.module("risevision.widget.common.google-drive-picker").factory("oauthAPILoader",["$q","$log","gapiLoader",function(e,o,i){var t,n=e.defer();return{get:function(){return t||(t=n.promise,i.get().then(function(e){e.load("auth",function(){o.info("auth API is loaded"),n.resolve(e)})})),t}}}]).factory("gapiLoader",["$q","$window",function(i,t){return{get:function(){var e,o=i.defer();return t.isClientJS?o.resolve(t.gapi):(e=function(){o.resolve(t.gapi),t.removeEventListener("gapi.loaded",e,!1)},t.addEventListener("gapi.loaded",e,!1)),o.promise}}}]).factory("pickerLoader",["$q","$window","$log","gapiLoader",function(i,e,t,n){return{get:function(){var e,o=i.defer();return e||(e=o.promise,n.get().then(function(e){e.load("picker",function(){t.info("picker API is loaded"),o.resolve(e)})})),e}}}])}(),function(){"use strict";angular.module("risevision.widget.common.google-drive-picker").value("CLIENT_ID","343504042718-oi19fakuj8fdfa015p7k2gkn2vkshdfh.apps.googleusercontent.com").value("SCOPE",["https://www.googleapis.com/auth/drive.readonly"]).factory("apiAuth",["$q","$http","$log","gapiLoader","oauthAPILoader","CLIENT_ID","SCOPE",function(t,e,n,o,r,c,a){var u=null,i={authorize:function(e){var o=t.defer(),i={client_id:c,scope:a,immediate:e};return r.get().then(function(e){e.auth.authorize(i,function(e){e&&!e.error?(u=e.access_token,o.resolve(e)):(o.reject("Authentication Error: "+e.error),n.debug("authorize result",e))})}),o.promise},getAuthToken:function(){return u}};return i}])}(),function(){"use strict";angular.module("risevision.widget.common.google-drive-picker").factory("apiGooglePicker",["$q","$window","$log","pickerLoader",function(e,o,i,t){var n,r=e.defer();return{get:function(){return n||(n=r.promise,t.get().then(function(){r.resolve(o.google)})),n}}}])}();